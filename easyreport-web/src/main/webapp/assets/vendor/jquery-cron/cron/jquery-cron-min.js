!function(e){function t(e){return"undefined"==typeof e?!1:!0}function n(e){return!t(e)||"object"==typeof e}function i(n,i){if(t(i.customValues))for(key in i.customValues)if(n==i.customValues[key])return key;var s=/^0\s(0\/1|\d{1,2})\s(0\/1|\d{1,2}|\*)\s(\d{1,2}|\*|\?)\s(\d{1,2}|\*)\s(\d{1,2}|\?)(\s\*)?$/;if("string"!=typeof n||!s.test(n))return void e.error("cron: invalid initial value");var r=n.split(" ");r=r.splice(1,r.length-1);for(var a=[0,0,1,1,1],l=[59,23,31,12,7],c=0;c<r.length;c++)if("*"!=r[c]&&!/^0\/1$/.test(r[c])&&"?"!=r[c]){var d=parseInt(r[c]);if(!(t(d)&&d<=l[c]&&d>=a[c]))return void e.error("cron: invalid value found (col "+(c+1)+") in "+o.initial)}for(var u in k)if(k[u].test(n))return u;e.error("cron: valid but unsupported cron format. sorry.")}function s(o,s){if(!t(i(s.initial,s)))return!0;if(!n(s.customValues))return!0;if(t(s.customValues))for(key in s.customValues)if(k.hasOwnProperty(key))return e.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0;return!1}function r(e){var t=e.data("block"),o=hour=day=month=dow="*",n=t.period.find("select").val();switch(n){case"minute":return["0","0/1","*","*","*","?"].join(" ");case"hour":return o=t.mins.find("select").val(),["0",o,"0/1","*","*","?"].join(" ");case"day":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),["0",o,hour,"*","*","?"].join(" ");case"week":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),dow=t.dow.find("select").val(),["0",o,hour,"?","*",dow].join(" ");case"month":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),["0",o,hour,day,"*","?"].join(" ");case"year":return o=t.time.find("select.cron-time-min").val(),hour=t.time.find("select.cron-time-hour").val(),day=t.dom.find("select").val(),month=t.month.find("select").val(),["0",o,hour,day,month,"?","*"].join(" ");default:return n}}for(var a={initial:"0 0/1 * * * ?",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:void 0,title:"Minutes Past the Hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:void 0,title:"Time: Hour"},domOpts:{minWidth:100,itemWidth:30,columns:void 0,rows:10,title:"Day of Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:void 0,title:void 0},dowOpts:{minWidth:100,itemWidth:void 0,columns:void 0,rows:void 0,title:void 0},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:void 0,title:"Time: Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:void 0,customValues:void 0,onChange:void 0,useGentleSelect:!1},l="",c=0;60>c;c++){var d=10>c?"0":"";l+="<option value='"+c+"'>"+d+c+"</option>\n"}for(var u="",c=0;24>c;c++){var d=10>c?"0":"";u+="<option value='"+c+"'>"+d+c+"</option>\n"}for(var m="",c=1;32>c;c++){if(1==c||21==c||31==c)var h="st";else if(2==c||22==c)var h="nd";else if(3==c||23==c)var h="rd";else var h="th";m+="<option value='"+c+"'>"+c+h+"</option>\n"}for(var p="",v=["January","February","March","April","May","June","July","August","September","October","November","December"],c=0;c<v.length;c++)p+="<option value='"+(c+1)+"'>"+v[c]+"</option>\n";for(var f="",y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=0;c<y.length;c++)f+="<option value='"+(c+1)+"'>"+y[c]+"</option>\n";for(var g="",O=["minute","hour","day","week","month","year"],c=0;c<O.length;c++)g+="<option value='"+O[c]+"'>"+O[c]+"</option>\n";var b={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]},k={minute:/^0\s(0\/1)\s(\*\s){3}\?$/,hour:/^0\s\d{1,2}\s(0\/1)\s(\*\s){2}\?$/,day:/^0\s(\d{1,2}\s){2}(\*\s){2}\?$/,week:/^0\s(\d{1,2}\s){2}\?\s(\*\s)\d{1,2}$/,month:/^0\s(\d{1,2}\s){3}\*\s\?$/,year:/^0\s(\d{1,2}\s){4}\?\s\*$/},w={init:function(o){var n=o?o:{},i=e.extend([],a,n),r=e.extend({},a.effectOpts,n.effectOpts);if(e.extend(i,{minuteOpts:e.extend({},a.minuteOpts,r,n.minuteOpts),domOpts:e.extend({},a.domOpts,r,n.domOpts),monthOpts:e.extend({},a.monthOpts,r,n.monthOpts),dowOpts:e.extend({},a.dowOpts,r,n.dowOpts),timeHourOpts:e.extend({},a.timeHourOpts,r,n.timeHourOpts),timeMinuteOpts:e.extend({},a.timeMinuteOpts,r,n.timeMinuteOpts)}),s(this,i))return this;var c=[],d="",h=i.customValues;if(t(h))for(var v in h)d+="<option value='"+h[v]+"'>"+v+"</option>\n";c.period=e("<span class='cron-period'>Every <select name='cron-period'>"+d+g+"</select> </span>").appendTo(this).data("root",this);var y=c.period.find("select");return y.bind("change.cron",S.periodChanged).data("root",this),i.useGentleSelect&&y.gentleSelect(r),c.dom=e("<span class='cron-block cron-block-dom'> on the <select name='cron-dom'>"+m+"</select> </span>").appendTo(this).data("root",this),y=c.dom.find("select").data("root",this),i.useGentleSelect&&y.gentleSelect(i.domOpts),c.month=e("<span class='cron-block cron-block-month'> of <select name='cron-month'>"+p+"</select> </span>").appendTo(this).data("root",this),y=c.month.find("select").data("root",this),i.useGentleSelect&&y.gentleSelect(i.monthOpts),c.mins=e("<span class='cron-block cron-block-mins'> at <select name='cron-mins'>"+l+"</select> minutes past the hour </span>").appendTo(this).data("root",this),y=c.mins.find("select").data("root",this),i.useGentleSelect&&y.gentleSelect(i.minuteOpts),c.dow=e("<span class='cron-block cron-block-dow'> on <select name='cron-dow'>"+f+"</select> </span>").appendTo(this).data("root",this),y=c.dow.find("select").data("root",this),i.useGentleSelect&&y.gentleSelect(i.dowOpts),c.time=e("<span class='cron-block cron-block-time'> at <select name='cron-time-hour' class='cron-time-hour'>"+u+"</select>:<select name='cron-time-min' class='cron-time-min'>"+l+" </span>").appendTo(this).data("root",this),y=c.time.find("select.cron-time-hour").data("root",this),i.useGentleSelect&&y.gentleSelect(i.timeHourOpts),y=c.time.find("select.cron-time-min").data("root",this),i.useGentleSelect&&y.gentleSelect(i.timeMinuteOpts),c.controls=e("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'></span> </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",S.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",S.somethingChanged),this.data("options",i).data("block",c),this.data("current_value",i.initial),w.value.call(this,i.initial)},value:function(e){if(!e)return r(this);var o=this.data("options"),n=this.data("block"),s=o.useGentleSelect,a=i(e,o);if(!t(a))return!1;if(t(o.customValues)&&o.customValues.hasOwnProperty(a))a=o.customValues[a];else{var l=e.split(" ");l=l.splice(1,l.length-1);for(var c=0;c<l.length;c++)/^0\/1$/.test(l[c])&&(l[c]=void 0),"?"===l[c]&&(l[c]=void 0);for(var d={mins:l[0],hour:l[1],dom:l[2],month:l[3],dow:l[4]},u=b[a],c=0;c<u.length;c++){var m=u[c];if("time"==m){var h=n[m].find("select.cron-time-hour").val(d.hour);s&&h.gentleSelect("update"),h=n[m].find("select.cron-time-min").val(d.mins),s&&h.gentleSelect("update")}else{var h=n[m].find("select").val(d[m]);s&&h.gentleSelect("update")}}}var p=n.period.find("select").val(a);return s&&p.gentleSelect("update"),p.trigger("change"),this}},S={periodChanged:function(){var t=e(this).data("root"),o=t.data("block"),n=(t.data("options"),e(this).val());if(t.find("span.cron-block").hide(),b.hasOwnProperty(n))for(var i=b[e(this).val()],s=0;s<i.length;s++)o[i[s]].show()},somethingChanged:function(){root=e(this).data("root"),t(root.data("options").url_set)?w.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var o=root.data("options").onChange;t(o)&&e.isFunction(o)&&o.call(root)},saveClicked:function(){var t=e(this),o=t.data("root"),n=w.value.call(o);t.hasClass("cron-loading")||(t.addClass("cron-loading"),e.ajax({type:"POST",url:o.data("options").url_set,data:{cron:n},success:function(){o.data("current_value",n),t.removeClass("cron-loading"),n==w.value.call(o)&&(o.removeClass("cron-changed"),o.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?"),t.removeClass("cron-loading")}}))}};e.fn.cron=function(t){return w[t]?w[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.cron"):w.init.apply(this,arguments)}}(jQuery);
